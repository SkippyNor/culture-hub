#{extends themeInfo.get('themeLayout') /}

#{set title: messages.get('thing.virtualNodes') /}

#{set bodyId: 'organization' /}

#{breadcrumbs crumbs: breadcrumbs /}

#{organizationNavBar orgId: orgId, active:"virtualNode", navigation: navigation /}

<div class="row">
    <div class="span12">

        <table class="table table-striped">
            <caption>&{'thing.virtualNodes'}</caption>
            <thead>
            <tr>
                <th>&{'thing.title'}</th>
                <th width="25%">&{'thing.actions'}</th>
            </tr>
            </thead>
            <!-- ko if: nodes().length > 0 -->
            <tbody data-bind="foreach: nodes()">
            <tr>
                <td>
                    <span class="node-title" data-bind="text: title"></span>
                </td>
                <td>
                    <a class="btn btn-primary btn-mini" href="#" data-bind="click: function() { $parent.update($data) }" rel="nofollow">
                        <i class="icon-edit icon-white"></i> &{'ui.label.edit'}
                    </a>
                    <a class="btn btn-danger btn-mini pull-right delete" href="#" data-bind="click: function() { $parent.delete($data) }" rel="nofollow">
                        <i class="icon-trash icon-white"></i> &{'ui.label.delete'}
                    </a>
                </td>
            </tr>
            </tbody>
            <!-- /ko -->
            <!-- ko if: !nodes().length > 0 -->
            <tbody>
            <tr>
                <td colspan="2">
                    No entries
                </td>
                <td>
                    <a class="btn btn-primary btn-mini" href="/organizations/${orgId}/virtualNode/add" rel="nofollow">${messages.get('plugin.virtualNode.create')}</a>
                </td>
            </tr>
            </tbody>
            <!-- /ko -->
        </table>

    </div>
</div>

<script type="text/javascript">
    $(document).ready(function () {

        var viewModel = {
            update: function (node) {
                document.location = "/organizations/${orgId}/virtualNode/" + node.id() + "/update"
            },
            delete: function(node) {
                bootboxConfirm({
                    'type': 'DELETE',
                    'message' : '<h3 class="shout">' + node.name() + '</h3>&{'plugin.virtualNode.deleteConfirm'}',
                    'action_url' : '/organizations/${orgId}/virtualNode/' + node.id(),
                    'success_callback' : function () {
                        viewModel.nodes.remove(function (item) {
                            return item.key === node.key;
                        });
                    }

                });
            }
        };

        load(${data.raw()}, viewModel, null, function () {
            $("body").css('visibility', 'visible');
        });
    });
</script>